syntax = "proto3";

package blockstorage;

service ServiceComm
{
    rpc Prepare(PrepareRequest) returns (PrepareReply) {}
    rpc Commit(CommitRequest) returns (CommitReply) {}
    rpc GetTransactionStatus(GetTransactionStatusRequest) returns (GetTransactionStatusReply) {}
    rpc Sync(SyncRequest) returns (stream SyncReply);
}

message FileData
{
    string file_name = 1;
    uint32 offset = 2;
    uint32 size = 3;
}

message PrepareRequest
{
    string transationId = 1;
    string buffer = 2;
    repeated FileData file_data = 3;
}

message PrepareReply
{
    uint32 status = 1;
}

message CommitRequest
{
    string transationId = 1;
    repeated string file_name = 2;
}

message CommitReply
{
    uint32 status = 1;
}

message GetTransactionStatusRequest
{
    string transationId = 1;
}

message GetTransactionStatusReply
{
    uint32 status = 1;
}

message SyncRequest {
    string ip = 1;
}

message SyncReply {
    repeated Operation ops = 1;
}

message Operation {
    string txnId = 1;
    string filePath = 2;
    string buffer = 3;
} 